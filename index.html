<!DOCTYPE html>
<html>
   <head>
      <meta charset="UTF-8">
      <link rel="stylesheet" type="text/css" href="css/index.css">
      <link rel="stylesheet" type="text/css" href="css/alarm.css">
      <title>Lab 5</title>
   </head>
   <body>
      <script>
         // This is called with the results from from FB.getLoginStatus().
         function statusChangeCallback(response) {
          console.log(response);
          // The response object is returned with a status field that lets the
          // app know the current login status of the person.
          // Full docs on the response object can be found in the documentation
          // for FB.getLoginStatus().
          if (response.status === 'connected') {
            // Logged into your app and Facebook.
            FB.api('/me', function(response) {
               console.log('Successful login for: ' + response.name + ' with id: ' + response.id);
               $("#loginStatus").empty();
               document.getElementById('loginStatus').innerHTML = '[Logged in as ' + response.name + ']';
               $("#userId").value(response.id);
               $("#addAlarmBtn").show();
               getAllAlarms(response.id);
            });
          } else if (response.status === 'not_authorized') {
            // The person is logged into Facebook, but not your app.
            $("#loginStatus").empty();
            document.getElementById('loginStatus').innerHTML = '[Not logged in]';
            $("#addAlarmBtn").hide();
            
          } else {
            // The person is not logged into Facebook, so we're not sure if
            // they are logged into this app or not.
            $("#loginStatus").empty();
            document.getElementById('loginStatus').innerHTML = '[Not logged in]';
            $("#addAlarmBtn").hide();
            
          }
         }

         // This function is called when someone finishes with the Login
         // Button.  See the onlogin handler attached to it in the sample
         // code below.
         function checkLoginState() {
          FB.getLoginStatus(function(response) {
            statusChangeCallback(response);
          });
         }

         window.fbAsyncInit = function() {
            FB.init({
             appId      : '807480552633971',
             cookie     : true,  // enable cookies to allow the server to access 
                                 // the session
             xfbml      : true,  // parse social plugins on this page
             version    : 'v2.1' // use version 2.1
            });

            // Now that we've initialized the JavaScript SDK, we call 
            // FB.getLoginStatus().  This function gets the state of the
            // person visiting this page and can return one of three states to
            // the callback you provide.  They can be:
            //
            // 1. Logged into your app ('connected')
            // 2. Logged into Facebook, but not your app ('not_authorized')
            // 3. Not logged into Facebook and can't tell if they are logged into
            //    your app or not.
            //
            // These three cases are handled in the callback function.

            FB.getLoginStatus(function(response) {
             statusChangeCallback(response);
            });
         };

         // Load the SDK asynchronously
         (function(d, s, id) {
          var js, fjs = d.getElementsByTagName(s)[0];
          if (d.getElementById(id)) return;
          js = d.createElement(s); js.id = id;
          js.src = "//connect.facebook.net/en_US/sdk.js";
          fjs.parentNode.insertBefore(js, fjs);
         }(document, 'script', 'facebook-jssdk'));
      </script>

      <h1 class="title">JP's Clock</h1>
      
      <div id="clock">00:00:00</div>

      <div id="cityLabel"></div>
      
      <div class="forecast" id="forecastLabel"></div>

      <img class="forecast" id="forecastIcon"></img>

      <div id="alarmContainer">
         <div id="alarmHeader" class="flexable">
            <div id="alarmHeading">
               <h2 style="display:inline-block;">Alarms </h2>
               <p id="loginStatus" style="display:inline"></p>
            </div>
            <input type="button" class="button" onclick="showAlarmPopup()" id="addAlarmBtn" value="Add Alarm"/>
         </div>

         <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
         </fb:login-button>

         <div id="status">
         </div>
         <div id="alarms"></div>
      </div>

      <div id="mask" class="hide"></div>

      <input type="hidden" id="userId">

      <div id="popup" class="hide">
         <h2>Add Alarm</h2>
         <div id="timeContainer">
            <select id="hours">
            </select>
            <select id="mins">
            </select>
            <select id="ampm">
               <option>am</option>
               <option>pm</option>
            </select>
         </div>
         <input type="text" id="alarmName" placeholder="Alarm Name" />
         <div class="flexable">
            <input type="button" class="button" onclick="hideAlarmPopup()" value="Cancel" />
            <input type="button" class="button" onclick="addAlarm()" value="Save Alarm" />
         </div>
      </div>

      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js" type="text/javascript"></script>
      <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false"></script>
      <script src="http://www.parsecdn.com/js/parse-1.3.4.min.js"></script>
      <script src="js/index.js" type="text/javascript"></script>
   </body>
</html>